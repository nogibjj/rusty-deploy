## A Distroless Rust PyTorch Example

### Rust Image Prediction Web Server

This is a Rust code that uses the Actix Web framework to create a simple web server that takes an image as input, runs it through a pre-trained ResNet34 model to make a prediction, and returns the predicted class and confidence score as a JSON response.

### Error Handling

The code imports necessary libraries and creates a `CustomError` enum for handling various errors. It also implements `From` traits for various error types and `ResponseError` trait for `CustomError` to generate `HttpResponse` from the errors.

### Routes

There are four main routes defined:

1. **GET /**: The index route, which returns instructions on how to send an image payload using curl for making predictions.
2. **POST /predict**: The predict route, which receives an image as a multipart payload, processes it, runs the image through a ResNet34 model, and returns the predicted class and confidence score as a JSON response.
3. **GET /self_check**: The self_check route, which checks if the model is loaded and runs a dummy input through it, returning a success message if it works.

## Main Function

The `main` function sets up the logger, initializes the Actix Web server, and binds it to the "127.0.0.1:8080" address.

## Debugging

`RUST_BACKTRACE=1 cargo run`

### Install

* run `./install.sh` to setup torchlib
* You should see a successful test like follows:

```bash
/usr/local/lib/libtorch already exists. Deleting it to proceed with the installation.
LIBTORCH is already in ~/.bashrc
LD_LIBRARY_PATH is already in ~/.bashrc
Checking if libtorch is installed correctly...
Verifying that C++ PyTorch API is functional...
-- Configuring done
-- Generating done
-- Build files have been written to: /workspaces/rusty-deploy/rtorchdist/build
Scanning dependencies of target check_pytorch
[ 50%] Building CXX object CMakeFiles/check_pytorch.dir/check_pytorch.cpp.o
[100%] Linking CXX executable check_pytorch
[100%] Built target check_pytorch
 0.2312  0.1560  0.2892
 0.1933  0.5848  0.6959
[ CPUFloatType{2,3} ]
C++ PyTorch API is functional. Installation complete.

```

### Test against Image

* The index route will give you an example to curl against.
* Selfcheck will self check model:  `curl localhost:8080/self_check`

### More Testing

* You can run: `cargo test --test vision_tests` after you build to ensure PyTorch is actually working with Rust bindings
* You can run: `cargo test --test model_tests` which tests model loading or `cargo test --test model_tests -- --nocapture`


#### Notes

* Pre-trained model here generated by running inside a python virtualenv:  `./convertdl.py`
* Next verify the model works by running in virtualenv: `./verify.py`

